<div id="layout">

    <!-- Header -->
    <header class="header">
        <div class="header-aside">
            <ng-container *ngIf="tabsVisible$|async">
                <div class="header-icon">
                    <img src="/assets/i/logo.svg" alt="">
                </div>
                <h1 class="header-text">Pagename</h1>
            </ng-container>
            <ng-container *ngIf="!(tabsVisible$|async)">
                <a class="header-link" (click)="back()">
                    <div class="header-icon">
                        <img src="/assets/i/back.svg" alt="">
                    </div>
                    <h2 class="header-text">/current item header/</h2>
                </a>
            </ng-container>
        </div>
        <div class="header-nav">
            <!-- TODO: move active button to state -->
            <app-toolbar [buttons]="['desktop', 'mobile', 'tablet', 'full']" [activeButton]="viewMode"
                (buttonClick)="viewMode = $event"></app-toolbar>
            <div class="header-actions">
                <button class="btn btn--outline">
                    <span class="btn__text">Publish</span>
                </button>
                <button class="btn btn--blue">
                    <span class="btn__text">Save</span>
                </button>
            </div>
        </div>
    </header>
    <!-- End Header -->

    <!-- Main -->
    <main class="main" [attr.data-view]="viewMode">

        <!-- Left panel -->
        <div class="left-panel">

            <!-- Tabs -->
            <app-tabs class="tabs tabs--full tabs--shadow" *ngIf="tabsVisible$|async">
                <app-tab class="tabs__content" tabTitle="Sections" active="true">
                    <app-page-editor class="left-panel-content" [model]="page$ | async" [schema]="blocksSchema$ | async"
                        (selectEvent)="selectPageItem($event)" [noSchema]="schemaNotLoaded$ | async"
                        [noPage]="pageNotLoaded$ | async" (reloadData)="reloadEditorData()"
                        (orderChangedEvent)="onOrderChanged($event)" (addNewBlockEvent)="setNewBlockMode()">
                    </app-page-editor>
                    <div class="left-panel-footer">footer</div>
                </app-tab>
                <app-tab class="tabs__content" tabTitle="Theme">
                    <app-theme-editor [schema]="themeSchema$ | async" (selectPresetEvent)="turnOnPresets()"
                        [noSchema]="themeSchemaNotLoaded$ | async" [noPresets]="presetsNotLoaded$ | async"
                        (reloadData)="reloadThemeData()" (selectItemEvent)="selectSchemaItem($event)">
                    </app-theme-editor>
                </app-tab>
            </app-tabs>

            <!-- End Tabs -->

            <app-page-item-editor *ngIf="currentSectionItem$|async as currentSectionItem" [model]="currentSectionItem"
                [schema]="(blocksSchema$ | async)[currentSectionItem.type]"
                (valueChangedEvent)="updateBlockPreview($event)" (removeBlockEvent)="removeBlock($event)"
                (copyBlockEvent)="copyBlock($event)"></app-page-item-editor>
            <app-select-type *ngIf="addNewSectionMode$ | async" [schema]="blocksSchema$ | async"
                (previewBlockEvent)="previewBlockType($event)" (selectBlockEvent)="selectBlockType($event)">
            </app-select-type>
            <app-presets-editor *ngIf="showPresets$|async" [data]="presets$|async"
                (savePresetEvent)="onSavePreset($event)" (selectPresetEvent)="onSelectPreset($event)"
                (applyThemeEvent)="applyPresetAsTheme($event)" (removePresetEvent)="onRemovePreset($event)">
            </app-presets-editor>
            <app-theme-item-editor *ngIf="currentThemeSchemaItem$|async as currentSchemaItem"
                [schema]="currentSchemaItem" [theme]="theme$|async" (valueChangedEvent)="liveUpdateTheme($event)">
            </app-theme-item-editor>
        </div>
        <!-- End Left panel -->

        <!-- Content -->
        <app-preview [loading]="previewLoading$ | async" [storeUrl]="storeUrl$" mode="desktop"
            (preivewLoaded)="onPreviewLoaded($event)"></app-preview>
        <!-- End Content -->

    </main>
    <!-- End Main -->

</div>