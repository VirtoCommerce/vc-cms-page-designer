!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),n=s(2),o=s(3),l=s(4),r=s(5),c=s(7);document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("designer-preview"),t=new i.HttpService(c.Environment.RenderBlockApiUrl),s=new n.MessagesService(c.Environment.DesignerUrl),h=new l.View(e),d=new r.ListController(h,t,s);new o.App(d).run()})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HttpService=class{constructor(e){this.endpoint=e}get(){}post(e){return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("post",this.endpoint),i.setRequestHeader("Accept","application/json, text/javascript, text/plain"),i.setRequestHeader("Cache-Control","no-cache"),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e)),i.onload=(e=>{t(i.responseText.trim())})})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MessagesService=class{constructor(e){this.parentOrigin=e}renderComplete(){this.send("render-complete",null)}blockHover(e){this.send("hover",{id:e.id})}selectBlock(e){this.send("open",e?{id:e.id}:null)}send(e,t){const s=Object.assign({type:e},t);console.log(s),window.parent.postMessage(s,this.parentOrigin)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.App=class{constructor(e){this.controller=e}run(){this.init(),this.reloadResources()}init(){window.addEventListener("message",e=>{var t=e.data;this.controller.messageReceived(t)})}reloadResources(){var e="?preview_mode="+new URLSearchParams(window.location.search).get("preview_mode")+"&v="+(new Date).getTime(),t=document.getElementsByTagName("link"),s=document.getElementsByTagName("head").item(0);function i(e){var t=document.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),t}for(var n=0;n<t.length;n++){var o=t[n];if(o.href&&o.href.startsWith(document.location.origin)&&o.href.endsWith(".css")){var l=i(o.href+e);s.replaceChild(l,o)}}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.View=class{constructor(e){this.container=e,this.highlightDiv=this.createShadowElement(),this.selectDiv=this.createShadowElement(),document.body.appendChild(this.highlightDiv),document.body.appendChild(this.selectDiv),this.highlightDiv.style.border="3px dotted #33ada9",this.selectDiv.style.border="3px solid #33ada9",this.highlightDiv.addEventListener("mouseleave",()=>{this.highlightDiv.style.display="none"}),this.highlightDiv.addEventListener("click",e=>{this.eventListener.elementClick(),this.placeElementHover(this.highlightDiv,this.selectDiv),this.unlight()}),this.selectDiv.addEventListener("click",e=>{this.eventListener.elementClick(),this.placeElementHover(this.selectDiv,this.highlightDiv),this.deselect()})}highlight(e){this.placeElementHover(e.element,this.highlightDiv)}unlight(){this.highlightDiv.style.display="none"}select(e){this.placeElementHover(e.element,this.selectDiv)}deselect(){this.selectDiv.style.display="none"}scrollTo(e){const t=this.measureElement(e.element).top-window.innerHeight/10;window.scroll({top:t,behavior:"smooth"})}setList(e){this.container.innerHTML="",e.forEach(e=>this.container.appendChild(e.element))}insertElement(e,t){const s=this.container.children.item(e);this.container.insertBefore(t.element,s)}setElement(e,t){const s=t.element;if(this.container.children.length>e){const i=this.container.children.item(e);i!=s&&(this.container.replaceChild(s,i),this.select(t))}else this.container.appendChild(s)}placeElementHover(e,t){const s=this.measureElement(e);t.style.top=s.top+"px",t.style.left=s.left+"px",t.style.height=s.height-6+"px",t.style.width=s.width-6+"px",t.style.display="block"}createShadowElement(){const e=document.createElement("div");return e.style.position="absolute",e.style.display="none",e.style.zIndex="10000",e}measureElement(e){const t=e,s=t.offsetWidth,i=t.offsetHeight;let n={},o=0,l=0;var r=function(e){if(!e)return n={top:t.offsetTop+l,left:t.offsetLeft+o,height:i,width:s};o+=e.offsetLeft,l+=e.offsetTop,r(e.offsetParent)};return r(t.offsetParent),n}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(6);t.ListController=class{constructor(e,t,s){this.view=e,this.http=t,this.messageSerice=s,this.blocks=[],e.eventListener=this}renderComplete(){this.messageSerice.renderComplete()}messageReceived(e){switch(e.type){case"addOrUpdate":this.addOrUpdate(e);break;case"settings":document.location.reload();break;case"scrollTo":this.scrollTo(e);break;case"select":this.selectBlock(e);break;case"remove":this.removeBlock(e);break;case"clone":this.cloneBlock(e);break;case"page":this.reloadPage(e);break;case"move":this.moveBlock(e);break;case"setVisibility":break;default:console.log(e.type,e)}}elementHover(e){this.highlightedBlock&&(this.view.unlight(),this.highlightedBlock=null),this.selectedBlock!==e&&e&&(this.highlightedBlock=e,this.view.highlight(e)),this.messageSerice.blockHover(e.model)}elementClick(){const e=this.selectedBlock&&this.selectedBlock===this.highlightedBlock?null:this.highlightedBlock;this.selectedBlock=e,this.messageSerice.selectBlock(e?e.model:null)}addOrUpdate(e){if(this.removeBlockById(null),e.content){const t=this.asKey(e.content.id),s=this.getBlock(t)||this.createBlockViewModel(e.content);s.model=e.content;const i=this.setBlock(t,s);this.generateElement(s,!0).then(e=>{this.view.setElement(i,s)})}}scrollTo(e){const t=this.getBlockById(e.content.id);this.view.scrollTo(t)}selectBlock(e){this.selectedBlock&&this.view.deselect();const t=this.getBlockById(e.content.id);t&&this.view.select(t),this.selectedBlock=t}removeBlock(e){this.removeBlockById(e.content.id)}cloneBlock(e){const t=this.getBlockById(e.content.source),s=this.blocks.indexOf(t),i=this.createBlockViewModel(Object.assign({},t.model));i.model.id=e.content.destination,i.fromHtml(t.html),this.view.insertElement(s+1,i),this.addBlock(i,s+1),this.selectBlock({content:{id:e.content.destination}})}reloadPage(e){this.blocks=[],e.content.filter(e=>"settings"!==e.type).forEach(e=>this.addBlock(this.createBlockViewModel(e))),this.render()}moveBlock(e){const t=this.blocks[e.content.currentIndex];this.blocks.splice(e.content.currentIndex,1),this.blocks.splice(e.content.newIndex,0,t),this.scrollTo({content:{id:t.model.id}})}render(){const e=this.blocks.map(e=>this.generateElement(e));Promise.all(e).then(()=>{this.view.setList(this.blocks),this.raiseRenderComplete()})}generateElement(e,t=!1){return t||!e.element?this.http.post(e.model).then(t=>(e.fromHtml(t),e)):Promise.resolve(e)}raiseRenderComplete(){this.renderComplete()}removeBlockById(e){const t=this.asKey(e),s=this.getBlock(t);if(s){const e=this.blocks.indexOf(s);this.selectedBlock==s&&(this.selectedBlock=null),s.remove(),this.blocks.splice(e,1),delete this.blocks[t]}}addBlock(e,t=null){null===t?this.blocks.push(e):this.blocks.splice(t,0,e),this.setBlockById(e.model.id,e)}setBlock(e,t){let s=this.blocks.indexOf(t);return-1===s&&(s=this.blocks.length,this.blocks.push(t)),this.blocks[e]=t,s}setBlockById(e,t){const s=this.asKey(e);this.setBlock(s,t)}getBlock(e){return this.blocks[e]}getBlockById(e){const t=this.asKey(e);return this.getBlock(t)}asKey(e){return e||0==e?`instance${e}`:"preview-instance"}createBlockViewModel(e){const t=new i.BlockViewModel(e);return t.eventListener=this,t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockViewModel=class{constructor(e){this.hoverListener=(()=>this.eventListener.elementHover(this)),this.model=e}get model(){return this._model}set model(e){this._model!=e&&(this._model=e)}fromHtml(e){this.html=e,this.createElement()}remove(){this.element&&(this.eventListener=null,this.element.remove())}createElement(){this.element&&this.element.removeEventListener("mouseover",this.hoverListener);const e=document.createElement("div");e.innerHTML=`<div>${this.html}</div>`;const t=e.firstChild;t.addEventListener("mouseover",this.hoverListener),this.element=t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Environment={RenderBlockApiUrl:"/designer-preview/block",DesignerUrl:"http://localhost/"}}]);
//# sourceMappingURL=designer.bundle.js.map