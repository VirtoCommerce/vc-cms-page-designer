!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);t.BaseHandler=class{get renderer(){return r.ServiceLocator.getRenderer()}execute(e,t){let n=this.getViewModel(e.content.id,t);n||(n=this.createViewModel(e.content)),this.executeInternal(e,t,n)}executeInternal(e,t,n){}reloadBlock(e){return r.ServiceLocator.getHttp().post(e)}generateId(e){return e?`instance${e}`:"preview-instance"}createViewModel(e){return{id:this.generateId(e.id),source:e,element:null,htmlString:null,selected:!1,hidden:!1}}getViewModel(e,t){const n=this.generateId(e);return t.find(e=>e.id===n)}deselectAll(e){e.forEach(e=>e.selected=!1)}clearPreview(e){const t=this.generateId(null);e.filter(e=>e.id===t).map((e,t)=>({item:e,index:t})).forEach(t=>{e.splice(t.index,1),t.item.element.remove()})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),s=n(5),o=n(6),c=n(7),i=n(2),l=n(21);t.ServiceLocator=class{static createApp(){return new l.App(this.getDispatcher())}static getHttp(){return this._http||(this._http=new r.HttpService(i.Environment.RenderBlockApiUrl))}static getRenderer(){return this._renderer||(this._renderer=new o.Renderer(document.getElementById("designer-preview")))}static getFactory(){return this._factory||(this._factory=new c.HandlersFactory)}static getDispatcher(){return this._dispatcher||(this._dispatcher=new s.EventsDispatcher(this.getFactory()))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Environment={RenderBlockApiUrl:"/designer-preview/block",DesignerUrl:"http://localhost/"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(1);document.addEventListener("DOMContentLoaded",()=>{console.log("run preview window"),r.ServiceLocator.createApp().run()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HttpService=class{constructor(e){this.endpoint=e}get(){}post(e){return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("post",this.endpoint),r.setRequestHeader("Accept","application/json, text/javascript, text/plain"),r.setRequestHeader("Cache-Control","no-cache"),r.setRequestHeader("Content-Type","application/json"),r.send(JSON.stringify(e)),r.onload=(e=>{t(r.responseText.trim())})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.EventsDispatcher=class{constructor(e){this.factory=e,this.handleMessage=(()=>{})}run(){window.addEventListener("message",e=>{e.data&&this.handleEvent(e.data)})}handleEvent(e){const t=this.factory.get(e.type);t&&this.handleMessage(t,e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Renderer=class{constructor(e){this.container=e,this.borderWidth=3,this.hoverElement=this.createHoverElement(),this.selectElement=this.createSelectElement()}add(e){e.element=this.createElement(e.htmlString),this.container.append(e.element)}update(e){const t=e.element;e.element=this.createElement(e.htmlString),this.container.replaceChild(e.element,t)}insert(e,t){e.element=this.createElement(e.htmlString);const n=this.container.children.item(t);this.container.insertBefore(e.element,n),e.hidden&&(e.element.style.display="none")}select(e=null){null===e||e.hidden||!e.selected?this.selectElement.style.display="none":(this.selectElement.style.display="block",this.placeElementHover(e.element,this.selectElement))}createElement(e){const t=document.createElement("div");return t.innerHTML=`<div>${e}</div>`,t.firstChild}createHoverElement(){const e=this.createShadowElement();return e.style.border="3px dotted #33ada9",e}createSelectElement(){const e=this.createShadowElement();return e.style.border="3px solid #33ada9",e}createShadowElement(){const e=document.createElement("div");return e.style.position="absolute",e.style.display="none",e.style.zIndex="10000",document.body.appendChild(e),e}placeElementHover(e,t){const n=this.measureElement(e);t.style.top=n.top+"px",t.style.left=n.left+"px",t.style.height=n.height-6+"px",t.style.width=n.width-6+"px",t.style.display="block"}measureElement(e){const t=e,n=t.offsetWidth,r=t.offsetHeight;let s={},o=0,c=0;var i=function(e){if(!e)return s={top:t.offsetTop+c,left:t.offsetLeft+o,height:r,width:n};o+=e.offsetLeft,c+=e.offsetTop,i(e.offsetParent)};return i(t.offsetParent),s}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8);class s{get(e){return s.handlers.find(t=>t.key==e)}}s.handlers=[new r.AddHandler,new r.UpdateHandler,new r.CloneHandler,new r.HideHandler,new r.ShowHandler,new r.RemoveHandler,new r.PreviewHandler,new r.SelectHandler,new r.SwapHandler,new r.ReloadHandler,new r.PageHandler,new r.HoverHandler],t.HandlersFactory=s},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(9)),r(n(10)),r(n(11)),r(n(12)),r(n(13)),r(n(14)),r(n(15)),r(n(16)),r(n(17)),r(n(18)),r(n(19)),r(n(20))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.AddHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="add"}executeInternal(e,t,n){this.clearPreview(t),t.push(n),n.selected=!0,this.reloadBlock(n.source).then(e=>{n.htmlString=e,this.renderer.add(n),this.renderer.select(n)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.CloneHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="clone"}execute(e,t){this.deselectAll(t);const n=this.getViewModel(e.content.source,t),r={id:this.generateId(e.content.destination),source:Object.assign({},n.source,{id:e.content.destination}),htmlString:n.htmlString,hidden:n.hidden,element:null,selected:!0},s=t.indexOf(n);t.splice(s+1,0,r),this.renderer.insert(r,s+1),this.renderer.select(r)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.HideHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="hide"}executeInternal(e,t,n){n.hidden=!0,n.element.style.display="none"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.HoverHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="hover"}executeInternal(e,t,n){}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.PreviewHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="preview"}execute(e,t){if(e.content){const n=this.createViewModel(e.content);t.push(n),this.reloadBlock(n.source).then(e=>{n.htmlString=e,this.renderer.add(n)})}else this.clearPreview(t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.RemoveHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="remove"}executeInternal(e,t,n){const r=t.indexOf(n);t.splice(r,1),n.element.remove(),this.renderer.select()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.SelectHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="select"}execute(e,t){this.deselectAll(t),0===e.content.id?this.renderer.select():super.execute(e,t)}executeInternal(e,t,n){n.selected=!0,this.renderer.select(n)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.ShowHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="show"}executeInternal(e,t,n){n.hidden=!1,n.element.style.display="block"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.SwapHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="swap"}execute(e,t){const n=t[e.content.currentIndex];t.splice(e.content.currentIndex,1),t.splice(e.content.newIndex,0,n),n.element.remove(),this.renderer.insert(n,e.content.newIndex)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.UpdateHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="update"}executeInternal(e,t,n){n.source=e.content,this.reloadBlock(n.source).then(e=>{n.htmlString=e,this.renderer.update(n),this.renderer.select(n)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.ReloadHandler=class extends r.BaseHandler{constructor(){super(...arguments),this.key="reload"}execute(e,t){document.location.reload()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),s=n(0);t.PageHandler=class extends s.BaseHandler{constructor(){super(...arguments),this.key="page"}execute(e,t){console.log(e),e.content.blocks.forEach(e=>{const n=this.createViewModel(e);t.push(n)}),Promise.all(t.map(e=>this.reloadBlock(e.source).then(t=>(e.htmlString=t,t)))).then(()=>{t.forEach(e=>{this.renderer.add(e)}),window.parent.postMessage({type:"render-complete"},r.Environment.DesignerUrl)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.App=class{constructor(e){this.dispatcher=e,this.list=[]}run(){this.dispatcher.handleMessage=((e,t)=>{e.execute(t,this.list)}),this.dispatcher.run(),this.reloadResources()}reloadResources(){var e="?preview_mode="+new URLSearchParams(window.location.search).get("preview_mode")+"&v="+(new Date).getTime(),t=document.getElementsByTagName("link"),n=document.getElementsByTagName("head").item(0);function r(e){var t=document.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),t}for(var s=0;s<t.length;s++){var o=t[s];if(o.href&&o.href.startsWith(document.location.origin)&&o.href.endsWith(".css")){var c=r(o.href+e);n.replaceChild(c,o)}}}}}]);
//# sourceMappingURL=designer.bundle.js.map