{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./handlers/base.handler.ts","webpack:///./service-locator.ts","webpack:///./environment.ts","webpack:///./main.ts","webpack:///./services/http.service.ts","webpack:///./events.dispatcher.ts","webpack:///./renderer.ts","webpack:///./handlers.factory.ts","webpack:///./handlers/index.ts","webpack:///./handlers/add.handler.ts","webpack:///./block.view-model.ts","webpack:///./handlers/clone.handler.ts","webpack:///./handlers/hide.handler.ts","webpack:///./handlers/hover.handler.ts","webpack:///./handlers/preview.handler.ts","webpack:///./handlers/remove.handler.ts","webpack:///./handlers/select.handler.ts","webpack:///./handlers/show.handler.ts","webpack:///./handlers/swap.handler.ts","webpack:///./handlers/update.handler.ts","webpack:///./handlers/reload.handler.ts","webpack:///./handlers/page.handler.ts","webpack:///./app.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","block_view_model_1","service_locator_1","BaseHandler","renderer","ServiceLocator","getRenderer","[object Object]","msg","list","vm","this","getViewModel","content","id","createViewModel","executeInternal","model","getHttp","post","isPreview","result","BlockViewModel","assign","generateId","source","element","htmlString","selected","hidden","internalId","find","x","forEach","map","item","index","filter","splice","remove","http_service_1","events_dispatcher_1","renderer_1","handlers_factory_1","environment_1","app_1","App","getDispatcher","_http","HttpService","Environment","RenderBlockApiUrl","_renderer","Renderer","document","getElementById","_factory","HandlersFactory","_dispatcher","EventsDispatcher","getFactory","DesignerUrl","addEventListener","console","log","createApp","run","endpoint","Promise","resolve","reject","xhr","XMLHttpRequest","open","setRequestHeader","send","JSON","stringify","onload","evt","responseText","trim","factory","handleMessage","window","event","data","handleEvent","handler","type","container","borderWidth","hoverElement","createHoverElement","selectElement","createSelectElement","createElement","append","replaceChild","beforeElement","children","insertBefore","style","display","placeElementHover","div","innerHTML","firstChild","onHover","onClick","createShadowElement","border","position","zIndex","body","appendChild","target","rect","measureElement","top","left","height","width","target_width","offsetWidth","target_height","offsetHeight","gleft","gtop","moonwalk","_parent","offsetTop","offsetLeft","offsetParent","handlers","AddHandler","UpdateHandler","CloneHandler","HideHandler","ShowHandler","RemoveHandler","PreviewHandler","SelectHandler","SwapHandler","ReloadHandler","PageHandler","HoverHandler","__export","base_handler_1","clearPreview","push","reloadBlock","then","add","select","eventsDispatcher","selectBlock","highlightBlock","deselectAll","destination","clone","indexOf","insert","super","execute","currentIndex","newIndex","update","location","reload","blocks","all","html","parent","postMessage","dispatcher","reloadResources","suffix","URLSearchParams","search","Date","getTime","nodes","getElementsByTagName","head","generateLinkNode","url","setAttribute","length","styleSheet","href","startsWith","origin","endsWith","newlink"],"mappings":"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","file":"designer.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","import { Renderer } from './../renderer';\r\nimport { BaseMessage, MessageContent } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\nimport { MessageHandler } from \"./message.handler\";\r\nimport { ServiceLocator } from '../service-locator';\r\n\r\nexport abstract class BaseHandler implements MessageHandler {\r\n\r\n    abstract readonly key: string;\r\n    protected get renderer(): Renderer {\r\n        return ServiceLocator.getRenderer();\r\n    }\r\n\r\n    execute(msg: BaseMessage, list: BlockViewModel[]) {\r\n        let vm = this.getViewModel(msg.content.id, list);\r\n        if (!vm) {\r\n            vm = this.createViewModel(msg.content);\r\n        }\r\n        this.executeInternal(msg, list, vm);\r\n    }\r\n\r\n    protected executeInternal(msg: BaseMessage, list: BlockViewModel[], vm: BlockViewModel) { }\r\n\r\n    protected reloadBlock(model: any): Promise<string> {\r\n        return ServiceLocator.getHttp().post(model);\r\n    }\r\n\r\n    protected generateId(id: number) {\r\n        if (id) {\r\n            return `instance${id}`;\r\n        }\r\n        return 'preview-instance';\r\n    }\r\n\r\n    protected createViewModel(content: MessageContent, isPreview = false): BlockViewModel {\r\n        const result = new BlockViewModel();\r\n        Object.assign(result, {\r\n            id: this.generateId(content.id),\r\n            source: content,\r\n            element: null,\r\n            isPreview: isPreview,\r\n            htmlString: null,\r\n            selected: false,\r\n            hidden: false\r\n        });\r\n        return result;\r\n    }\r\n\r\n    protected getViewModel(id: number, list: BlockViewModel[]): BlockViewModel {\r\n        const internalId = this.generateId(id);\r\n        return list.find(x => x.id === internalId);\r\n    }\r\n\r\n    protected deselectAll(list: BlockViewModel[]) {\r\n        list.forEach(x => x.selected = false);\r\n    }\r\n\r\n    protected clearPreview(list: BlockViewModel[]) {\r\n        const listToRemove = list.map((item, index) => <any>{ item, index }).filter(x => x.item.isPreview);\r\n        listToRemove.forEach(x => {\r\n            list.splice(x.index, 1);\r\n            x.item.element.remove();\r\n        });\r\n    }\r\n}","import { HttpService } from './services/http.service';\r\nimport { EventsDispatcher } from './events.dispatcher';\r\nimport { Renderer } from './renderer';\r\nimport { HandlersFactory } from './handlers.factory';\r\nimport { Environment } from './environment';\r\nimport { App } from './app';\r\n\r\nexport class ServiceLocator {\r\n\r\n    private static _http;\r\n    private static _renderer;\r\n    private static _factory;\r\n    private static _dispatcher;\r\n    private static _controller;\r\n\r\n    static createApp(): any {\r\n        return new App(this.getDispatcher());\r\n    }\r\n\r\n    static getHttp(): HttpService {\r\n        return this._http || (this._http = new HttpService(Environment.RenderBlockApiUrl));\r\n    }\r\n\r\n    static getRenderer(): Renderer {\r\n        return this._renderer || (this._renderer = new Renderer(document.getElementById(\"designer-preview\")));\r\n    }\r\n\r\n    static getFactory(): HandlersFactory {\r\n        return this._factory || (this._factory = new HandlersFactory());\r\n    }\r\n\r\n    static getDispatcher(): EventsDispatcher {\r\n        return this._dispatcher || (this._dispatcher = new EventsDispatcher(this.getFactory()));\r\n    }\r\n}","export const Environment = {\r\n    RenderBlockApiUrl: '/designer-preview/block',\r\n    DesignerUrl: 'http://localhost/'\r\n    // DesignerUrl: 'http://vc-admin-test.azurewebsites.net/designer'\r\n}\r\n","import { ServiceLocator } from './service-locator';\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    console.log('run preview window')\r\n    const app = ServiceLocator.createApp();\r\n    app.run();\r\n});\r\n","export class HttpService {\r\n\r\n    constructor(private endpoint: string) { }\r\n\r\n    get() {\r\n\r\n    }\r\n\r\n    post(model: any): Promise<string> {\r\n        // https://gist.github.com/codecorsair/e14ec90cee91fa8f56054afaa0a39f13\r\n        return new Promise<string>((resolve, reject) => {\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.open('post', this.endpoint);\r\n\r\n            xhr.setRequestHeader('Accept', 'application/json, text/javascript, text/plain')\r\n            xhr.setRequestHeader('Cache-Control', 'no-cache');\r\n            xhr.setRequestHeader('Content-Type', 'application/json');\r\n            xhr.send(JSON.stringify(model));\r\n            // xhr.timeout = timeout;\r\n            xhr.onload = evt => {\r\n                // const result = {\r\n                //     ok: xhr.status >= 200 && xhr.status < 300,\r\n                //     status: xhr.status,\r\n                //     statusText: xhr.statusText,\r\n                //     headers: xhr.getAllResponseHeaders(),\r\n                //     data: xhr.responseText\r\n                // };\r\n                resolve(xhr.responseText.trim());\r\n                // this.blocks.push(model); or replace\r\n            };\r\n            // xhr.onerror = evt => {\r\n            //   resolve(errorResponse(xhr, 'Failed to make request.'));\r\n            // };\r\n            // xhr.ontimeout = evt => {\r\n            //   resolve(errorResponse(xhr, 'Request took longer than expected.'));\r\n            // };\r\n        });\r\n    }\r\n\r\n/*\r\n\r\n\r\n\r\n\r\n*/\r\n\r\n\r\n\r\n\r\n}","import { HandlersFactory } from \"./handlers.factory\";\r\nimport { MessageHandler } from \"./handlers\";\r\nimport { BaseMessage, BlockViewModel } from \"./models\";\r\n\r\nexport class EventsDispatcher {\r\n    handleMessage: (handler: MessageHandler, msg: BaseMessage) => void = () => {};\r\n\r\n    constructor(private factory: HandlersFactory) { }\r\n\r\n    run() {\r\n        window.addEventListener('message', (event: MessageEvent) => {\r\n            if (event.data) {\r\n                this.handleEvent(event.data)\r\n            }\r\n        });\r\n    }\r\n\r\n    selectBlock(vm: BlockViewModel) {\r\n        console.log('select', vm);\r\n    }\r\n\r\n    highlightBlock(vm: BlockViewModel) {\r\n        console.log('hover', vm);\r\n    }\r\n\r\n    swapBlock() {\r\n\r\n    }\r\n\r\n    private handleEvent(msg: BaseMessage) {\r\n        const handler = this.factory.get(msg.type);\r\n        if (handler) {\r\n            this.handleMessage(handler, msg);\r\n        }\r\n    }\r\n}\r\n","import { BlockViewModel } from './block.view-model';\r\n\r\nexport class Renderer {\r\n    private readonly borderWidth: number = 3;\r\n\r\n    private hoverElement: HTMLElement;\r\n    private selectElement: HTMLElement;\r\n\r\n    constructor(private container: HTMLElement) {\r\n        this.hoverElement = this.createHoverElement();\r\n        this.selectElement = this.createSelectElement();\r\n    }\r\n\r\n    add(vm: BlockViewModel) {\r\n        vm.element = this.createElement(vm);\r\n        this.container.append(vm.element);\r\n    }\r\n\r\n    update(vm: BlockViewModel) {\r\n        const element = vm.element;\r\n        vm.element = this.createElement(vm);\r\n        this.container.replaceChild(vm.element, element);\r\n    }\r\n\r\n    insert(vm: BlockViewModel, index: number) {\r\n        vm.element = this.createElement(vm);\r\n        const beforeElement = this.container.children.item(index);\r\n        this.container.insertBefore(vm.element, beforeElement);\r\n        if (vm.hidden) {\r\n            vm.element.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    select(vm: BlockViewModel = null) {\r\n        if (vm === null || vm.hidden || !vm.selected) {\r\n            this.selectElement.style.display = 'none';\r\n        } else {\r\n            this.selectElement.style.display = 'block';\r\n            this.placeElementHover(vm.element, this.selectElement);\r\n        }\r\n    }\r\n\r\n    private createElement(vm: BlockViewModel) {\r\n        const div = document.createElement('div');\r\n        div.innerHTML = `<div>${vm.htmlString}</div>`;\r\n        const result = <HTMLElement>div.firstChild;\r\n        if (!vm.isPreview) {\r\n            result.addEventListener('mouseover', () => vm.onHover());\r\n            result.addEventListener('click', () => vm.onClick());\r\n        }\r\n        // TODO: add events\r\n        //      hover\r\n        //      mouse up\r\n        //      mouse down\r\n        //      mouse move\r\n        return result;\r\n    }\r\n\r\n    private createHoverElement(): HTMLElement {\r\n        const result = this.createShadowElement();\r\n        result.style.border = '3px dotted #33ada9';\r\n        // result.addEventListener('mouseleave', () => {\r\n        //     result.style.display = 'none';\r\n        // })\r\n        // result.addEventListener('click', (event) => {\r\n        //     this.eventListener.elementClick();\r\n        //     this.placeElementHover(this.highlightDiv, this.selectDiv);\r\n        //     this.unlight();\r\n        // })\r\n        // this.selectDiv.style.border = '3px solid #33ada9';\r\n        // this.selectDiv.addEventListener('click', (event) => {\r\n        //     this.eventListener.elementClick();\r\n        //     this.placeElementHover(this.selectDiv, this.highlightDiv);\r\n        //     this.deselect();\r\n        // })\r\n\r\n        return result;\r\n    }\r\n\r\n    private createSelectElement(): HTMLElement {\r\n        const result = this.createShadowElement();\r\n        result.style.border = '3px solid #33ada9';\r\n        return result;\r\n    }\r\n\r\n    private createShadowElement(): HTMLElement {\r\n        const result = document.createElement('div');\r\n        result.style.position = 'absolute';\r\n        result.style.display = 'none';\r\n        result.style.zIndex = '10000';\r\n        document.body.appendChild(result);\r\n        return result;\r\n    }\r\n\r\n    private placeElementHover(source: HTMLElement, target: HTMLElement) {\r\n        const rect = this.measureElement(source);\r\n        target.style.top = rect.top + 'px';\r\n        target.style.left = rect.left + 'px';\r\n        target.style.height = (rect.height - 6) + 'px';\r\n        target.style.width = (rect.width - 6) + 'px';\r\n        target.style.display = 'block';\r\n    }\r\n\r\n    private measureElement(element): { top?: number, left?: number, height?: number, width?: number } {\r\n        const target = element;\r\n        const target_width = target.offsetWidth;\r\n        const target_height = target.offsetHeight;\r\n        let rect = {};\r\n        let gleft = 0;\r\n        let gtop = 0;\r\n\r\n        var moonwalk = function (_parent) {\r\n            if (!!_parent) {\r\n                gleft += _parent.offsetLeft;\r\n                gtop += _parent.offsetTop;\r\n                moonwalk(_parent.offsetParent);\r\n            } else {\r\n                return rect = {\r\n                    top: target.offsetTop + gtop,\r\n                    left: target.offsetLeft + gleft,\r\n                    height: target_height,\r\n                    width: target_width\r\n                };\r\n            }\r\n        };\r\n        moonwalk(target.offsetParent);\r\n        return rect;\r\n    }\r\n}\r\n","import * as handlers from \"./handlers\";\r\n\r\nexport class HandlersFactory {\r\n    private static handlers: handlers.MessageHandler[] = [\r\n        new handlers.AddHandler(),\r\n        new handlers.UpdateHandler(),\r\n        new handlers.CloneHandler(),\r\n        new handlers.HideHandler(),\r\n        new handlers.ShowHandler(),\r\n        new handlers.RemoveHandler(),\r\n        new handlers.PreviewHandler(),\r\n        new handlers.SelectHandler(),\r\n        new handlers.SwapHandler(),\r\n        new handlers.ReloadHandler(),\r\n        new handlers.PageHandler(),\r\n        new handlers.HoverHandler()         // -\r\n    ];\r\n\r\n    get(key: string): handlers.MessageHandler {\r\n        return HandlersFactory.handlers.find(x => x.key == key);\r\n    }\r\n}\r\n","export * from './message.handler';\r\n\r\nexport * from './add.handler';\r\nexport * from './clone.handler';\r\nexport * from './hide.handler';\r\nexport * from './hover.handler';\r\nexport * from './preview.handler';\r\nexport * from './remove.handler';\r\nexport * from './select.handler';\r\nexport * from './show.handler';\r\nexport * from './swap.handler';\r\nexport * from './update.handler';\r\n\r\nexport * from './reload.handler';\r\nexport * from './page.handler';\r\n","import { ServiceLocator } from './../service-locator';\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\nimport { BaseHandler } from \"./base.handler\";\r\n\r\nexport class AddHandler extends BaseHandler {\r\n    readonly key = 'add';\r\n\r\n    protected executeInternal(msg: BaseMessage, list: BlockViewModel[], vm: BlockViewModel) {\r\n        this.clearPreview(list);\r\n        list.push(vm);\r\n        vm.selected = true;\r\n        this.reloadBlock(vm.source).then(result => {\r\n            vm.htmlString = result;\r\n            this.renderer.add(vm);\r\n            this.renderer.select(vm);\r\n        });\r\n    }\r\n}","import { ServiceLocator } from './service-locator';\r\nimport { EventsDispatcher } from './events.dispatcher';\r\nimport { MessageContent } from './models';\r\n\r\nexport class BlockViewModel {\r\n    id: string;\r\n    source: MessageContent;\r\n    element: HTMLElement;\r\n    htmlString: string;\r\n    selected: boolean; // is this field really necessary?\r\n    hidden: boolean;\r\n    isPreview: boolean;\r\n\r\n    onClick: () => void = () => {\r\n        this.eventsDispatcher.selectBlock(this);\r\n    };\r\n    onHover: () => void = () => {\r\n        this.eventsDispatcher.highlightBlock(this);\r\n    };\r\n\r\n    private get eventsDispatcher(): EventsDispatcher {\r\n        // TODO: ??\r\n        return ServiceLocator.getDispatcher();\r\n    }\r\n}\r\n","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class CloneHandler extends BaseHandler {\r\n    readonly key = 'clone';\r\n\r\n    execute(msg: BaseMessage, list: BlockViewModel[]) {\r\n        this.deselectAll(list);\r\n        const source = this.getViewModel(msg.content.source, list);\r\n\r\n        const model = { ...source.source, id: msg.content.destination };\r\n        const clone = this.createViewModel(model);\r\n        clone.htmlString = source.htmlString;\r\n        clone.hidden = source.hidden;\r\n        clone.selected = true;\r\n\r\n        const index = list.indexOf(source);\r\n        list.splice(index + 1, 0, clone);\r\n        this.renderer.insert(clone, index + 1);\r\n        this.renderer.select(clone);\r\n    }\r\n}","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class HideHandler extends BaseHandler {\r\n    readonly key = 'hide';\r\n\r\n    protected executeInternal(msg: BaseMessage, list: BlockViewModel[], vm: BlockViewModel) {\r\n        vm.hidden = true;\r\n        vm.element.style.display = 'none';\r\n    }\r\n}","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class HoverHandler extends BaseHandler {\r\n    readonly key = 'hover';\r\n\r\n    protected executeInternal(msg: BaseMessage, list: BlockViewModel[], vm: BlockViewModel) {\r\n    }\r\n}\r\n","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class PreviewHandler extends BaseHandler {\r\n    readonly key = 'preview';\r\n\r\n    execute(msg: BaseMessage, list: BlockViewModel[]) {\r\n        this.clearPreview(list);\r\n        if (!!msg.content) {\r\n            const vm = this.createViewModel(msg.content, true);\r\n            list.push(vm);\r\n            this.reloadBlock(vm.source).then(result => {\r\n                vm.htmlString = result;\r\n                this.renderer.add(vm);\r\n            });\r\n        }\r\n    }\r\n}","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class RemoveHandler extends BaseHandler {\r\n    readonly key = 'remove';\r\n\r\n    protected executeInternal(msg: BaseMessage, list: BlockViewModel[], vm: BlockViewModel) {\r\n        const index = list.indexOf(vm);\r\n        list.splice(index, 1);\r\n        vm.element.remove();\r\n        this.renderer.select();\r\n    }\r\n}","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class SelectHandler extends BaseHandler {\r\n    readonly key = 'select';\r\n\r\n    execute(msg: BaseMessage, list: BlockViewModel[]) {\r\n        this.deselectAll(list);\r\n        const content = msg.content;\r\n        if (content.id === 0) {\r\n            this.renderer.select();\r\n        } else {\r\n            super.execute(msg, list);\r\n        }\r\n    }\r\n\r\n    protected executeInternal(msg: BaseMessage, list: BlockViewModel[], vm: BlockViewModel) {\r\n        vm.selected = true;\r\n        this.renderer.select(vm);\r\n    }\r\n}","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class ShowHandler extends BaseHandler {\r\n    readonly key = 'show';\r\n\r\n    protected executeInternal(msg: BaseMessage, list: BlockViewModel[], vm: BlockViewModel) {\r\n        vm.hidden = false;\r\n        vm.element.style.display = 'block';\r\n    }\r\n}","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class SwapHandler extends BaseHandler {\r\n    readonly key = 'swap';\r\n\r\n    execute(msg: BaseMessage, list: BlockViewModel[]) {\r\n        const vm = list[msg.content.currentIndex];\r\n        list.splice(msg.content.currentIndex, 1);\r\n        list.splice(msg.content.newIndex, 0, vm);\r\n        vm.element.remove();\r\n        this.renderer.insert(vm, msg.content.newIndex);\r\n    }\r\n}","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class UpdateHandler extends BaseHandler {\r\n    readonly key = 'update';\r\n\r\n    protected executeInternal(msg: BaseMessage, list: BlockViewModel[], vm: BlockViewModel) {\r\n        vm.source = msg.content;\r\n        this.reloadBlock(vm.source).then((result: string) => {\r\n            vm.htmlString = result;\r\n            this.renderer.update(vm);\r\n            this.renderer.select(vm);\r\n        });\r\n    }\r\n}","import { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class ReloadHandler extends BaseHandler {\r\n    readonly key = 'reload';\r\n\r\n    execute(msg: BaseMessage, list: BlockViewModel[]) {\r\n        document.location.reload();\r\n    }\r\n}","import { Environment } from './../environment';\r\nimport { BaseHandler } from \"./base.handler\";\r\nimport { BaseMessage, MessageContent } from \"../models\";\r\nimport { BlockViewModel } from \"../block.view-model\";\r\n\r\nexport class PageHandler extends BaseHandler {\r\n    readonly key = 'page';\r\n\r\n    execute(msg: BaseMessage, list: BlockViewModel[]) {\r\n        console.log(msg);\r\n        const blocks = msg.content.blocks;\r\n        blocks.forEach(x => {\r\n            const vm = this.createViewModel(x);\r\n            list.push(vm);\r\n        });\r\n        Promise.all(list.map(x => {\r\n            const promise = this.reloadBlock(x.source).then(html => {\r\n                x.htmlString = html;\r\n                return html;\r\n            });\r\n            return promise;\r\n        })).then(() => {\r\n            list.forEach(x => {\r\n                this.renderer.add(x);\r\n            });\r\n            window.parent.postMessage({ type: 'render-complete' }, Environment.DesignerUrl);\r\n        });\r\n    }\r\n}","import { EventsDispatcher } from './events.dispatcher';\r\nimport { BlockViewModel } from './block.view-model';\r\n\r\nexport class App {\r\n    private list: BlockViewModel[] = [];\r\n\r\n    constructor(private dispatcher: EventsDispatcher) { }\r\n\r\n    run() {\r\n        this.dispatcher.handleMessage =\r\n            (handler, msg) => {\r\n                handler.execute(msg, this.list);\r\n            };\r\n        this.dispatcher.run();\r\n        this.reloadResources();\r\n    }\r\n\r\n    private reloadResources() {\r\n        var urlParams = new URLSearchParams(window.location.search);\r\n        var prefix = urlParams.get('preview_mode');\r\n        var suffix = \"?preview_mode=\" + prefix + \"&v=\" + (new Date().getTime());\r\n\r\n        var nodes = document.getElementsByTagName(\"link\");\r\n        var head = document.getElementsByTagName(\"head\").item(0);\r\n\r\n        function generateLinkNode(url) {\r\n            var result = document.createElement(\"link\");\r\n            result.setAttribute(\"rel\", \"stylesheet\");\r\n            result.setAttribute(\"type\", \"text/css\");\r\n            result.setAttribute(\"href\", url);\r\n            return result;\r\n        }\r\n\r\n        for (var i = 0; i < nodes.length; i++) {\r\n            var styleSheet = nodes[i];\r\n            if (styleSheet.href && styleSheet.href.startsWith(document.location.origin) && styleSheet.href.endsWith(\".css\")) {\r\n                var url = styleSheet.href + suffix;\r\n                var newlink = generateLinkNode(url);\r\n                head.replaceChild(newlink, styleSheet);\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":""}