!function(e){var t={};function s(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(o,i,function(t){return e[t]}.bind(null,i));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(1),i=s(2),n=s(4),r=s(5),l=s(6),c=s(7),h=s(8),d=s(9);document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("designer-preview"),t=new o.HttpService(d.Environment.RenderBlockApiUrl),s=new n.MessagesService(d.Environment.DesignerUrl),a=new l.View(e),u=new i.BlocksViewModelFactory(t),m=new h.ListViewModel(a,u),p=new c.Controller(m,s);new r.App(p).run()})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HttpService=class{constructor(e){this.endpoint=e}get(){}post(e){return new Promise((t,s)=>{const o=new XMLHttpRequest;o.open("post",this.endpoint),o.setRequestHeader("Accept","application/json, text/javascript, text/plain"),o.setRequestHeader("Cache-Control","no-cache"),o.setRequestHeader("Content-Type","application/json"),o.send(JSON.stringify(e)),o.onload=(e=>{t(o.responseText.trim())})})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=s(3);t.BlocksViewModelFactory=class{constructor(e){this.http=e}getBlockViewModel(e){return new o.BlockViewModel(e,this.http)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockViewModel=class{constructor(e,t){this.model=e,this.http=t}fromHtml(e){this.html=e,this.createElement()}select(){}deselect(){}remove(){this.element&&(this.eventListener=null,this.element.remove())}highlight(){}unlight(){}render(e,t,s=!1){return s||!this.element?this.http.post(this.model).then(s=>(this.fromHtml(s),e.setElement(t,this.element),this)):Promise.resolve(this)}createElement(){const e=document.createElement("div");e.innerHTML=this.html;const t=e.firstChild;t.addEventListener("mouseover",()=>this.eventListener.elementHover(this)),this.element=t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MessagesService=class{constructor(e){this.parentOrigin=e}renderComplete(){this.send("render-complete")}blockHover(e){this.send("hover")}selectBlock(e){this.send("select")}send(e){window.parent.postMessage({type:e},this.parentOrigin)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.App=class{constructor(e){this.controller=e}run(){this.init(),this.reloadResources()}init(){window.addEventListener("message",e=>{var t=e.data;this.controller.messageReceived(t)})}reloadResources(){var e="?preview_mode="+new URLSearchParams(window.location.search).get("preview_mode")+"&v="+(new Date).getTime(),t=document.getElementsByTagName("link"),s=document.getElementsByTagName("head").item(0);function o(e){var t=document.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),t}for(var i=0;i<t.length;i++){var n=t[i];if(n.href&&n.href.startsWith(document.location.origin)&&n.href.endsWith(".css")){var r=o(n.href+e);s.replaceChild(r,n)}}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.View=class{constructor(e){this.container=e,console.log(e)}setElement(e,t){if(this.container.children.length>e){const s=this.container.children.item(e);s!=t&&s.replaceWith(t)}else this.container.appendChild(t)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Controller=class{constructor(e,t){this.vm=e,this.messageSerice=t,this.init()}init(){this.vm.renderComplete=(()=>{this.messageSerice.renderComplete()}),this.vm.elementHover=(e=>{this.vm.highlightBlock(e),this.messageSerice.blockHover(e.model)}),this.vm.elementClick=(e=>{this.messageSerice.selectBlock(e.model)})}messageReceived(e){switch(e.type){case"addOrUpdate":this.vm.addOrUpdate(e);break;case"settings":document.location.reload();break;case"scrollTo":this.vm.scrollTo(e);break;case"select":this.vm.selectBlock(e);break;case"remove":this.vm.removeBlock(e);break;case"clone":this.vm.cloneBlock(e);break;case"page":this.vm.reloadPage(e);break;case"move":this.vm.moveBlock(e);break;default:console.log(e.type,e)}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ListViewModel=class{constructor(e,t){this.view=e,this.factory=t,this.blocks=[],this.renderComplete=(()=>{}),this.elementHover=(e=>{}),this.elementClick=(e=>{})}addOrUpdate(e){if(this.removeBlockById(null),e.content){const t=this.asKey(e.content.id),s=this.getBlock(t)||this.createBlockViewModel(e.content),o=this.setBlock(t,s);s.render(this.view,o,!0)}}scrollTo(e){}highlightBlock(e){this.highlightedBlock&&(this.highlightedBlock.unlight(),this.highlightedBlock=null),this.selectedBlock!==e&&(this.highlightedBlock=e,e.highlight())}selectBlock(e){const t=this.getBlockById(e.content.id);t.select(),this.selectedBlock&&this.selectedBlock.deselect(),this.selectedBlock=t}removeBlock(e){this.removeBlockById(e.content.id)}cloneBlock(e){const t=this.getBlockById(e.content.source),s=this.blocks.indexOf(t),o=this.createBlockViewModel(t.model);o.fromHtml(t.html),this.addBlock(o,s+1),this.selectBlock({content:{id:e.content.destination}})}reloadPage(e){this.blocks=[],e.content.filter(e=>"settings"!==e.type).forEach(e=>this.addBlock(this.createBlockViewModel(e))),this.render()}moveBlock(e){const t=this.blocks[e.content.currentIndex];this.blocks.splice(e.content.currentIndex,1),this.blocks.splice(e.content.newIndex,0,t),this.scrollTo({content:{id:t.model.id}})}render(){const e=this.blocks.map((e,t)=>e.render(this.view,t));Promise.all(e).then(()=>this.raiseRenderComplete())}raiseRenderComplete(){this.renderComplete()}removeBlockById(e){const t=this.asKey(e),s=this.getBlock(t);if(s){const e=this.blocks.indexOf(s);this.selectedBlock==s&&(this.selectedBlock=null),s.remove(),this.blocks.splice(e,1),delete this.blocks[t]}}addBlock(e,t=null){null===t?this.blocks.push(e):this.blocks.splice(t,0,e),this.setBlockById(e.model.id,e)}setBlock(e,t){let s=this.blocks.indexOf(t);return-1===s&&(s=this.blocks.length,this.blocks.push(t)),this.blocks[e]=t,s}setBlockById(e,t){const s=this.asKey(e);this.setBlock(s,t)}getBlock(e){return this.blocks[e]}getBlockById(e){const t=this.asKey(e);return this.getBlock(t)}asKey(e){return e||0==e?`instanse${e}`:"preview-instance"}createBlockViewModel(e){const t=this.factory.getBlockViewModel(e);return t.eventListener=this,t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Environment={RenderBlockApiUrl:"/designer-preview/block",DesignerUrl:"http://localhost:4200/"}}]);
//# sourceMappingURL=main.bundle.js.map