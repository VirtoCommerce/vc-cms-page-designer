!function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(s,o,function(t){return e[t]}.bind(null,o));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1);document.addEventListener("DOMContentLoaded",()=>{(new s.DesignerPreview).run(document.getElementById("designer-preview"))})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DesignerPreview=class{constructor(){this.RenderBlockApiUrl="/designer-preview/block",this.DesignerUrl="http://localhost:4200/",this.blocks=[],this.handlers={},this.selectedBlock=null}run(e){this.container=e,this.init(),this.ready()}init(){window.addEventListener("message",e=>{var t=e.data;this.dispatchEvent(t)}),this.handlers.addOrUpdate=(e=>this.addOrUpdate(e)),this.handlers.settings=(e=>this.reloadDocument(e)),this.handlers.scrollTo=(e=>this.scrollTo(e)),this.handlers.select=(e=>this.selectBlock(e)),this.handlers.remove=(e=>this.removeBlock(e)),this.handlers.clone=(e=>this.cloneBlock(e)),this.handlers.page=(e=>this.reloadPage(e)),this.handlers.move=(e=>this.moveBlock(e))}dispatchEvent(e){const t=this.handlers[e.type];null!==t?t(e):console.log(e.type,e)}syncView(){this.blocks.forEach((e,t)=>{const n=this.container.children.item(t);n?n!=e.element&&this.container.replaceChild(e.element,n):this.container.appendChild(e.element)})}reloadDocument(e){document.location.reload()}reloadPage(e){this.blocks=[],e.content.filter(e=>"settings"!==e.type).forEach(e=>this.addBlock({id:e.id,source:e,html:"",element:null})),Promise.all(this.blocks.map(e=>this.doRequest(e))).then(()=>{this.syncView(),window.parent.postMessage({type:"render-complete"},this.DesignerUrl)})}moveBlock(e){const t=this.blocks[e.content.currentIndex];this.blocks.splice(e.content.currentIndex,1),this.blocks.splice(e.content.newIndex,0,t),this.scrollTo({content:{id:t.id}})}cloneBlock(e){const t=this.getBlock(e.content.source),n=this.blocks.indexOf(t),s=Object.assign({},t,{id:e.content.destination,element:this.createElement(t.html)});this.addBlock(s,n+1),this.selectBlock({content:{id:e.content.destination}})}addOrUpdate(e){if(e.content){const t=this.getBlock(e.content.id)||{id:e.content.id};t.source=e.content,this.addBlock(t),this.doRequest(t).then(()=>{this.syncView(),this.selectBlock(e)})}}removeBlock(e){this.deleteBlock(e.content.id).element.remove()}selectBlock(e){const t=this.getBlock(e.content.id);this.selectedBlock&&this.selectedBlock!=t&&(this.selectedBlock.element.className=this.selectedBlock.element.className.split(" ").filter(e=>"active"!=e.trim()).join(" "),this.selectedBlock=null),t&&this.selectedBlock!=t&&(t.element.className+=" active",this.selectedBlock=t)}scrollTo(e){this.getBlock(e.content.id)}createElement(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild}doRequest(e){return new Promise((t,n)=>{const s=new XMLHttpRequest;s.open("post",this.RenderBlockApiUrl),s.setRequestHeader("Accept","application/json, text/javascript, text/plain"),s.setRequestHeader("Cache-Control","no-cache"),s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(e.source)),s.onload=(n=>{e.html=s.responseText.trim(),e.element=this.createElement(e.html),t(e)})})}ready(){var e="?preview_mode="+new URLSearchParams(window.location.search).get("preview_mode")+"&v="+(new Date).getTime(),t=document.getElementsByTagName("link"),n=document.getElementsByTagName("head").item(0);function s(e){var t=document.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),t}for(var o=0;o<t.length;o++){var i=t[o];if(i.href&&i.href.startsWith(document.location.origin)&&i.href.endsWith(".css")){var l=s(i.href+e);n.replaceChild(l,i)}}}addBlock(e,t=null){const n=this.asKey(e.id),s=this.getBlock(e.id);if(s){const t=this.blocks.indexOf(s);this.blocks[t]=e}else null!==t?this.blocks.splice(t,0,e):this.blocks.push(e);this.blocks[n]=e}getBlock(e){const t=this.asKey(e);return this.blocks[t]}deleteBlock(e){const t=this.asKey(e),n=this.getBlock(e);delete this.blocks[t];const s=this.blocks.indexOf(n);return this.blocks.splice(s,1),n}asKey(e){return`instanse${e}`}}}]);
//# sourceMappingURL=main.bundle.js.map