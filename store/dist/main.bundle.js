!function(e){var t={};function s(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(1),o=s(2),n=s(3),l=s(4),r=s(5),c=s(6),h=s(8);document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("designer-preview"),t=new i.HttpService(h.Environment.RenderBlockApiUrl),s=new o.MessagesService(h.Environment.DesignerUrl),d=new l.View(e),a=new c.ListViewModel(d,t),u=new r.Controller(a,s);new n.App(u).run()})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.HttpService=class{constructor(e){this.endpoint=e}get(){}post(e){return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("post",this.endpoint),i.setRequestHeader("Accept","application/json, text/javascript, text/plain"),i.setRequestHeader("Cache-Control","no-cache"),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify(e)),i.onload=(e=>{t(i.responseText.trim())})})}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MessagesService=class{constructor(e){this.parentOrigin=e}renderComplete(){this.send("render-complete")}blockHover(e){this.send("hover")}selectBlock(e){this.send("select")}send(e){window.parent.postMessage({type:e},this.parentOrigin)}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.App=class{constructor(e){this.controller=e}run(){this.init(),this.reloadResources()}init(){window.addEventListener("message",e=>{var t=e.data;this.controller.messageReceived(t)})}reloadResources(){var e="?preview_mode="+new URLSearchParams(window.location.search).get("preview_mode")+"&v="+(new Date).getTime(),t=document.getElementsByTagName("link"),s=document.getElementsByTagName("head").item(0);function i(e){var t=document.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),t}for(var o=0;o<t.length;o++){var n=t[o];if(n.href&&n.href.startsWith(document.location.origin)&&n.href.endsWith(".css")){var l=i(n.href+e);s.replaceChild(l,n)}}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.View=class{constructor(e){this.container=e,this.highlightDiv=this.createShadowElement(),this.selectDiv=this.createShadowElement(),document.body.appendChild(this.highlightDiv),document.body.appendChild(this.selectDiv)}highlight(e){const t=this.measureElement(e.element);this.highlightDiv.style.top=t.top+"px",this.highlightDiv.style.left=t.left+"px",this.highlightDiv.style.height=t.height+"px",this.highlightDiv.style.width=t.width+"px",this.highlightDiv.style.display="block",this.highlightDiv.style.backgroundColor="red",console.dir(t)}unlight(e){this.highlightDiv.style.display="none"}select(e){}deselect(e){}setElement(e,t){const s=t.element;if(this.container.children.length>e){const t=this.container.children.item(e);t!=s&&t.replaceWith(s)}else this.container.appendChild(s)}createShadowElement(){const e=document.createElement("div");return e.style.position="absolute",e.style.display="none",e}measureElement(e){var t=e,s=t.offsetWidth,i=t.offsetHeight,o=(t.offsetLeft,t.offsetTop,0),n=0,l={},r=function(e){if(!e)return l={top:t.offsetTop+n,left:t.offsetLeft+o,height:i,width:s};o+=e.offsetLeft,n+=e.offsetTop,r(e.offsetParent)};return r(t.offsetParent),l}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Controller=class{constructor(e,t){this.vm=e,this.messageSerice=t,this.init()}init(){this.vm.renderComplete=(()=>{this.messageSerice.renderComplete()}),this.vm.elementHover=(e=>{this.vm.highlightBlock(e),this.messageSerice.blockHover(e.model)}),this.vm.elementClick=(e=>{this.messageSerice.selectBlock(e.model)})}messageReceived(e){switch(e.type){case"addOrUpdate":this.vm.addOrUpdate(e);break;case"settings":document.location.reload();break;case"scrollTo":this.vm.scrollTo(e);break;case"select":this.vm.selectBlock(e);break;case"remove":this.vm.removeBlock(e);break;case"clone":this.vm.cloneBlock(e);break;case"page":this.vm.reloadPage(e);break;case"move":this.vm.moveBlock(e);break;default:console.log(e.type,e)}}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(7);t.ListViewModel=class{constructor(e,t){this.view=e,this.http=t,this.blocks=[],this.renderComplete=(()=>{}),this.elementHover=(e=>{}),this.elementClick=(e=>{})}addOrUpdate(e){if(this.removeBlockById(null),e.content){const t=this.asKey(e.content.id),s=this.getBlock(t)||this.createBlockViewModel(e.content),i=this.setBlock(t,s);this.view.setElement(i,s)}}scrollTo(e){}highlightBlock(e){this.highlightedBlock&&(this.view.unlight(this.highlightedBlock),this.highlightedBlock=null),this.selectedBlock!==e&&(this.highlightedBlock=e,this.view.highlight(e))}selectBlock(e){const t=this.getBlockById(e.content.id);this.view.select(t),this.selectedBlock&&this.view.deselect(this.selectedBlock),this.selectedBlock=t}removeBlock(e){this.removeBlockById(e.content.id)}cloneBlock(e){const t=this.getBlockById(e.content.source),s=this.blocks.indexOf(t),i=this.createBlockViewModel(t.model);i.fromHtml(t.html),this.addBlock(i,s+1),this.selectBlock({content:{id:e.content.destination}})}reloadPage(e){this.blocks=[],e.content.filter(e=>"settings"!==e.type).forEach(e=>this.addBlock(this.createBlockViewModel(e))),this.render()}moveBlock(e){const t=this.blocks[e.content.currentIndex];this.blocks.splice(e.content.currentIndex,1),this.blocks.splice(e.content.newIndex,0,t),this.scrollTo({content:{id:t.model.id}})}render(){const e=this.blocks.map((e,t)=>this.generateElement(e,t));Promise.all(e).then(()=>this.raiseRenderComplete())}generateElement(e,t,s=!1){return s||!e.element?this.http.post(e.model).then(s=>(e.fromHtml(s),this.view.setElement(t,e),e)):Promise.resolve(e)}raiseRenderComplete(){this.renderComplete()}removeBlockById(e){const t=this.asKey(e),s=this.getBlock(t);if(s){const e=this.blocks.indexOf(s);this.selectedBlock==s&&(this.selectedBlock=null),s.remove(),this.blocks.splice(e,1),delete this.blocks[t]}}addBlock(e,t=null){null===t?this.blocks.push(e):this.blocks.splice(t,0,e),this.setBlockById(e.model.id,e)}setBlock(e,t){let s=this.blocks.indexOf(t);return-1===s&&(s=this.blocks.length,this.blocks.push(t)),this.blocks[e]=t,s}setBlockById(e,t){const s=this.asKey(e);this.setBlock(s,t)}getBlock(e){return this.blocks[e]}getBlockById(e){const t=this.asKey(e);return this.getBlock(t)}asKey(e){return e||0==e?`instanse${e}`:"preview-instance"}createBlockViewModel(e){const t=new i.BlockViewModel(e);return t.eventListener=this,t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BlockViewModel=class{constructor(e){this.hoverListener=(()=>this.eventListener.elementHover(this)),this.model=e}get model(){return this._model}set model(e){this._model!=e&&(this._model=e,this.html=null)}fromHtml(e){this.html=e,this.createElement()}remove(){this.element&&(this.eventListener=null,this.element.remove())}createElement(){this.element&&(this.element.removeEventListener("mouseover",this.hoverListener),this.element.remove());const e=document.createElement("div");e.innerHTML=this.html;const t=e.firstChild;t.addEventListener("mouseover",this.hoverListener),this.element=t}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Environment={RenderBlockApiUrl:"/designer-preview/block",DesignerUrl:"http://localhost:4200/"}}]);
//# sourceMappingURL=main.bundle.js.map